
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gallows - Tecnotic</title>
    
    <!-- Enlace al Manifiesto de PWA -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#1e3a8a">
    <link rel="apple-touch-icon" href="icon-192.png">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <style>
        :root {
            --primary: #1e3a8a;
            --secondary: #991b1b;
            --accent: #f59e0b;
            --text: #1f2937;
            --card-bg: rgba(255, 255, 255, 0.95);
        }

        * {
            box-sizing: border-box;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: #e5e7eb;
            background-image: radial-gradient(at 0% 0%, hsla(253,16%,7%,1) 0, transparent 50%), 
                              radial-gradient(at 50% 0%, hsla(225,39%,30%,1) 0, transparent 50%), 
                              radial-gradient(at 100% 0%, hsla(339,49%,30%,1) 0, transparent 50%);
            background-attachment: fixed;
            margin: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: var(--text);
            padding: 20px;
            overflow-x: hidden;
        }

        .container {
            background: var(--card-bg);
            display: inline-flex;
            flex-direction: column;
            align-items: center;
            width: 500px;
            max-width: 95vw;
            padding: 2rem; 
            border-radius: 24px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            text-align: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
            position: relative;
            z-index: 10;
        }

        .top-header-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            margin-bottom: 20px;
            padding: 0 5px 10px 5px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        .btn-exit-top {
            background: #64748b;
            color: white;
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: all 0.2s;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .btn-exit-top:hover {
            background: #475569;
            transform: scale(1.1) rotate(90deg);
        }

        .header-brand {
            font-size: 0.9rem;
            font-weight: 800;
            color: #64748b;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        h1 {
            font-size: 2.5rem;
            margin-top: 0;
            color: var(--primary);
            letter-spacing: 4px;
            margin-bottom: 15px;
            font-weight: 900;
            text-transform: uppercase;
        }

        .stats-bar {
            display: flex;
            justify-content: space-between;
            gap: 20px;
            background: linear-gradient(90deg, var(--primary), #3b82f6);
            color: white;
            padding: 12px 20px;
            border-radius: 14px;
            margin-bottom: 20px;
            font-weight: bold;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            width: 100%;
        }

        .screen { 
            display: none; 
            width: 100%;
        }
        .active { 
            display: flex; 
            flex-direction: column;
            align-items: center;
        }

        .category-grid {
            display: grid;
            grid-template-columns: repeat(2, minmax(130px, 1fr));
            gap: 12px;
            width: 100%;
        }

        .btn-cat {
            padding: 15px;
            border: none;
            border-radius: 12px;
            background: var(--secondary);
            color: white;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 4px 0 #7f1d1d;
        }

        .btn-cat:hover { transform: translateY(-2px); box-shadow: 0 6px 0 #7f1d1d; }
        .btn-cat:active { transform: translateY(2px); box-shadow: 0 0 0 #7f1d1d; }

        .category-header {
            margin-bottom: 15px;
        }

        #cat-title {
            font-size: 1.4rem;
            font-weight: 800;
            color: var(--secondary);
            display: block;
        }

        .category-desc {
            font-size: 0.85rem;
            color: #6b7280;
            font-style: italic;
            margin-top: 4px;
            display: block;
        }

        #hangman-canvas {
            background: #ffffff;
            border-radius: 12px;
            border: 2px solid #e5e7eb;
            margin-bottom: 15px;
            max-width: 100%;
            height: auto;
        }

        .word-container {
            font-size: 2rem;
            letter-spacing: 8px;
            margin: 15px 0;
            font-family: 'Courier New', Courier, monospace;
            font-weight: 900;
            color: var(--primary);
            word-break: break-all;
        }

        .keyboard {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 5px;
            max-width: 450px;
            margin: 10px auto;
        }

        .key {
            width: 38px;
            height: 42px;
            border: 1px solid #d1d5db;
            background: white;
            border-radius: 6px;
            font-weight: bold;
            font-size: 0.9rem;
            cursor: pointer;
            box-shadow: 0 2px 0 #d1d5db;
        }

        .key:disabled { opacity: 0.4; cursor: not-allowed; box-shadow: none; }
        .key.correct { background: #10b981; color: white; border-color: #059669; box-shadow: 0 2px 0 #059669; }
        .key.wrong { background: #ef4444; color: white; border-color: #b91c1c; box-shadow: 0 2px 0 #b91c1c; }

        .tips-container {
            margin: 15px 0;
            padding: 15px 0;
            border-top: 1px solid #e5e7eb;
            width: 100%;
        }

        .btn-tip {
            background: var(--accent);
            border: none;
            padding: 8px 20px;
            border-radius: 50px;
            font-weight: bold;
            color: #78350f;
            cursor: pointer;
            box-shadow: 0 4px 0 #d97706;
            margin-bottom: 5px;
        }

        .btn-tip:disabled { background: #e5e7eb; color: #9ca3af; box-shadow: none; }

        .footer-msg {
            margin-top: 15px;
            font-weight: 600;
            color: #6b7280;
            font-size: 0.9rem;
            width: 100%;
        }

        .copyright-bar {
            margin-top: 25px;
            width: 100%;
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            align-items: center;
            font-size: 0.6rem;
            color: rgba(0, 0, 0, 0.25);
            text-transform: uppercase;
            letter-spacing: 2px;
            font-weight: 700;
            border-top: 1px solid rgba(0, 0, 0, 0.05);
            padding-top: 10px;
        }

        .copyright-bar .brand {
            grid-column: 2;
            text-align: center;
        }

        .copyright-bar .version {
            grid-column: 3;
            text-align: right;
            padding-right: 5px;
        }

        .overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(15, 23, 42, 0.9); display: none;
            justify-content: center; align-items: center; z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .modal {
            background: white; padding: 30px; border-radius: 20px;
            text-align: center; max-width: 350px; width: 90%;
        }

        #confetti-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 999;
        }

        @media (max-width: 480px) {
            .container { padding: 1.5rem; }
            .word-container { font-size: 1.5rem; letter-spacing: 4px; }
            .key { width: 32px; height: 38px; font-size: 0.8rem; }
            h1 { font-size: 1.8rem; }
            .header-brand { font-size: 0.75rem; }
            .copyright-bar { letter-spacing: 1px; }
        }
    </style>
</head>
<body>

<canvas id="confetti-canvas"></canvas>

<div class="container">
    <div class="top-header-bar">
        <button class="btn-exit-top" onclick="exitGame()" title="Cerrar aplicaci√≥n">‚úï</button>
        <div class="header-brand">CHECO</div>
    </div>

    <h1>GALLOWS</h1>
    
    <div class="stats-bar">
        <div>Vidas: <span id="lives-count">5</span> ‚ù§Ô∏è</div>
        <div>Premio: <span id="reward-count">$0</span> üí∞</div>
    </div>

    <div id="screen-start" class="screen active">
        <h3 style="color: #4b5563; margin-bottom: 15px;">Selecciona una categor√≠a:</h3>
        <div class="category-grid" id="category-grid"></div>
    </div>

    <div id="screen-game" class="screen">
        <div class="category-header">
            <span id="cat-title"></span>
            <span class="category-desc" id="cat-desc"></span>
        </div>
        <canvas id="hangman-canvas" width="200" height="220"></canvas>
        <div id="word-display" class="word-container"></div>
        <div id="keyboard" class="keyboard"></div>
        
        <div class="tips-container">
            <button id="btn-tip" class="btn-tip" onclick="useTip()">
                üí° TIPS: <span id="tip-count">2</span>
            </button>
            <div style="font-size: 0.7rem; color: #6b7280;">(Acierta 3 letras para ganar +1 tip)</div>
        </div>

        <button class="btn-cat" style="background: var(--primary); box-shadow: 0 4px 0 #1e3a8a; width: 100%;" onclick="promptResolve()">RESOLVER PALABRA</button>
    </div>

    <div class="footer-msg" id="motivational-msg"></div>
    
    <div class="copyright-bar">
        <div class="brand">Tecnotic ¬©</div>
        <div class="version">V1.0</div>
    </div>
</div>

<div id="overlay" class="overlay">
    <div class="modal">
        <div id="modal-content"></div>
        <button id="modal-btn" class="btn-cat" style="margin-top: 20px; width: 100%;" onclick="nextStep()">SIGUIENTE</button>
    </div>
</div>

<script>
    // --- REGISTRO DEL SERVICE WORKER PARA PWA ---
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('./sw.js')
                .then(registration => {
                    console.log('ServiceWorker registrado con √©xito: ', registration.scope);
                })
                .catch(error => {
                    console.log('Fallo en el registro del ServiceWorker: ', error);
                });
        });
    }

    const config = {
        categories: {
            "Alimentos": { 
                words: ["MANZANA", "PAN", "ARROZ", "PIZZA", "SOPA", "PASTA", "HUEVO", "LECHE", "CARNE", "TACO"], 
                icon: "üçé",
                desc: '"Frutas, vegetales y platos t√≠picos"'
            },
            "Moda": { 
                words: ["GORRA", "SACO", "JEAN", "RELOJ", "BOTAS", "FALDA", "TRAJE", "BOLSO", "GAFAS", "CINTA"], 
                icon: "üëó",
                desc: '"Ropa, accesorios y estilo"'
            },
            "Pel√≠culas": { 
                words: ["SHREK", "COCO", "UP", "JAWS", "RAMBO", "ALIEN", "TENET", "FROZEN", "DUNE", "ELVIS"], 
                icon: "üé¨",
                desc: '"T√≠tulos de cine y √©xitos de taquilla"'
            },
            "Autos": { 
                words: ["TESLA", "AUDI", "JEEP", "MAZDA", "FORD", "VOLVO", "FIAT", "BMW", "HONDA", "LADA"], 
                icon: "üöó",
                desc: '"Marcas y modelos de veh√≠culos"'
            },
            "Far√°ndula": { 
                words: ["CHISME", "FAMOSO", "PRENSA", "GALA", "IDOLO", "SHOW", "ELITE", "FAMA", "FOTO", "CINE"], 
                icon: "üåü",
                desc: '"Celebridades, premios y rumores"'
            },
            "Cine": { 
                words: ["GUION", "ACTOR", "CAMARA", "FILME", "CORTE", "FOCO", "CINE", "TOMA", "LUCES", "PAPEL"], 
                icon: "üé•",
                desc: '"Producci√≥n, actores y elementos t√©cnicos"'
            }
        },
        motivational: [
            "¬°T√∫ puedes hacerlo!", "¬°Esa mente est√° brillante hoy!", "¬°No te rindas!", 
            "¬°Eres un maestro!", "¬°Conc√©ntrate!", "¬°Adivina y gana!", "¬°Casi lo tienes!"
        ]
    };

    let state = {
        lives: 5,
        totalReward: 0,
        word: "",
        guesses: [],
        mistakes: 0,
        tipsAvailable: 2,
        correctCountSinceLastTip: 0
    };

    const canvas = document.getElementById('hangman-canvas');
    const ctx = canvas.getContext('2d');
    const confettiCanvas = document.getElementById('confetti-canvas');
    const cctx = confettiCanvas.getContext('2d');
    let confettiParticles = [];

    function playApplause() {
        try {
            const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            const duration = 1.5;
            const bufferSize = audioCtx.sampleRate * duration;
            const buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
            const data = buffer.getChannelData(0);
            for (let i = 0; i < bufferSize; i++) data[i] = (Math.random() * 2 - 1) * 0.1;
            const noise = audioCtx.createBufferSource();
            noise.buffer = buffer;
            const gain = audioCtx.createGain();
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + duration);
            noise.connect(gain);
            gain.connect(audioCtx.destination);
            noise.start();
        } catch(e) {}
    }

    function initConfetti() {
        confettiCanvas.width = window.innerWidth;
        confettiCanvas.height = window.innerHeight;
        confettiParticles = [];
        for (let i = 0; i < 100; i++) {
            confettiParticles.push({
                x: Math.random() * confettiCanvas.width,
                y: Math.random() * confettiCanvas.height - confettiCanvas.height,
                size: Math.random() * 8 + 4,
                color: `hsl(${Math.random() * 360}, 100%, 50%)`,
                speed: Math.random() * 3 + 2,
                angle: Math.random() * 360,
                spin: Math.random() * 8 - 4
            });
        }
        requestAnimationFrame(updateConfetti);
    }

    function updateConfetti() {
        if (confettiParticles.length === 0) return;
        cctx.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);
        let stillAlive = false;
        confettiParticles.forEach(p => {
            p.y += p.speed;
            p.angle += p.spin;
            if (p.y < confettiCanvas.height) {
                stillAlive = true;
                cctx.save();
                cctx.translate(p.x, p.y);
                cctx.rotate(p.angle * Math.PI / 180);
                cctx.fillStyle = p.color;
                cctx.fillRect(-p.size/2, -p.size/2, p.size, p.size);
                cctx.restore();
            }
        });
        if (stillAlive) requestAnimationFrame(updateConfetti);
        else cctx.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);
    }

    function init() {
        const grid = document.getElementById('category-grid');
        grid.innerHTML = "";
        Object.keys(config.categories).forEach(cat => {
            const btn = document.createElement('button');
            btn.className = 'btn-cat';
            btn.innerHTML = `${config.categories[cat].icon}<br>${cat}`;
            btn.onclick = () => startGame(cat);
            grid.appendChild(btn);
        });
        updateMotivation();
    }

    function updateMotivation() {
        const msg = config.motivational[Math.floor(Math.random() * config.motivational.length)];
        document.getElementById('motivational-msg').textContent = msg;
    }

    function startGame(catName) {
        const cat = config.categories[catName];
        state.word = cat.words[Math.floor(Math.random() * cat.words.length)].toUpperCase();
        state.guesses = [];
        state.mistakes = 0;
        state.tipsAvailable = 2;
        state.correctCountSinceLastTip = 0;

        document.getElementById('screen-start').classList.remove('active');
        document.getElementById('screen-game').classList.add('active');
        
        document.getElementById('cat-title').innerHTML = `${cat.icon} ${catName}`;
        document.getElementById('cat-desc').textContent = cat.desc;
        
        drawBase();
        updateDisplay();
        renderKeyboard();
        updateTipButton();
    }

    function drawBase() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.strokeStyle = "#4e342e";
        ctx.lineWidth = 6;
        ctx.lineCap = "round";
        ctx.beginPath();
        ctx.moveTo(20, 200); ctx.lineTo(180, 200); 
        ctx.moveTo(50, 200); ctx.lineTo(50, 20);   
        ctx.lineTo(130, 20); ctx.lineTo(130, 50);  
        ctx.stroke();
    }

    function drawPart(step) {
        ctx.strokeStyle = "#1e293b";
        ctx.lineWidth = 5;
        switch(step) {
            case 1: ctx.beginPath(); ctx.moveTo(130, 140); ctx.lineTo(110, 180); ctx.stroke(); break; 
            case 2: ctx.beginPath(); ctx.moveTo(130, 140); ctx.lineTo(150, 180); ctx.stroke(); break; 
            case 3: ctx.beginPath(); ctx.moveTo(130, 90); ctx.lineTo(130, 140); ctx.stroke(); break;  
            case 4: ctx.beginPath(); ctx.moveTo(130, 105); ctx.lineTo(105, 130); ctx.stroke(); break; 
            case 5: ctx.beginPath(); ctx.moveTo(130, 105); ctx.lineTo(155, 130); ctx.stroke(); break; 
            case 6: ctx.beginPath(); ctx.arc(130, 70, 20, 0, Math.PI*2); ctx.stroke(); break;        
        }
    }

    function updateDisplay() {
        const display = state.word.split('').map(l => state.guesses.includes(l) ? l : "_").join(" ");
        document.getElementById('word-display').textContent = display;
        if (!display.includes("_") && state.word !== "") handleResult(true);
    }

    function renderKeyboard() {
        const kb = document.getElementById('keyboard');
        kb.innerHTML = "";
        "ABCDEFGHIJKLMN√ëOPQRSTUVWXYZ".split("").forEach(l => {
            const btn = document.createElement('button');
            btn.className = 'key';
            btn.textContent = l;
            btn.id = `k-${l}`;
            btn.onclick = () => guess(l);
            kb.appendChild(btn);
        });
    }

    function guess(l) {
        if (state.guesses.includes(l) || state.mistakes >= 6) return;
        state.guesses.push(l);
        const btn = document.getElementById(`k-${l}`);
        if(btn) btn.disabled = true;

        if (state.word.includes(l)) {
            if(btn) btn.classList.add('correct');
            state.correctCountSinceLastTip++;
            if (state.correctCountSinceLastTip >= 3) {
                state.tipsAvailable++;
                state.correctCountSinceLastTip = 0;
                updateTipButton();
            }
        } else {
            if(btn) btn.classList.add('wrong');
            state.mistakes++;
            drawPart(state.mistakes);
            if (state.mistakes >= 6) handleResult(false);
        }
        updateDisplay();
    }

    function updateTipButton() {
        const btn = document.getElementById('btn-tip');
        document.getElementById('tip-count').textContent = state.tipsAvailable;
        btn.disabled = (state.tipsAvailable <= 0);
    }

    function useTip() {
        if (state.tipsAvailable <= 0) return;
        const remaining = state.word.split("").filter(l => !state.guesses.includes(l));
        if (remaining.length > 0) {
            const randomLetter = remaining[Math.floor(Math.random() * remaining.length)];
            state.tipsAvailable--;
            updateTipButton();
            guess(randomLetter);
        }
    }

    function promptResolve() {
        const res = prompt("¬øCu√°l es la palabra secreta?");
        if (!res) return;
        if (res.toUpperCase().trim() === state.word) {
            state.guesses = state.word.split("");
            updateDisplay();
        } else {
            alert("¬°Incorrecto!");
            state.mistakes++;
            drawPart(state.mistakes);
            if (state.mistakes >= 6) handleResult(false);
        }
    }

    function exitGame() {
        const overlay = document.getElementById('overlay');
        const content = document.getElementById('modal-content');
        const btn = document.getElementById('modal-btn');
        
        content.innerHTML = `
            <h2 style="color: #64748b; margin:0">CERRAR</h2>
            <p>¬øSeguro que deseas salir del juego?</p>
            <p>Tu progreso actual se perder√°.</p>
        `;
        btn.textContent = "SALIR AHORA";
        btn.onclick = () => {
            window.location.href = "about:blank";
        };
        overlay.style.display = 'flex';
    }

    function handleResult(win) {
        const overlay = document.getElementById('overlay');
        const content = document.getElementById('modal-content');
        const btn = document.getElementById('modal-btn');
        
        btn.textContent = "CONTINUAR";
        btn.onclick = nextStep;

        if (win) {
            state.totalReward += 10;
            document.getElementById('reward-count').textContent = `$${state.totalReward}`;
            content.innerHTML = `<h2 style="color: #d97706; margin:0">¬°EXCELENTE!</h2><p>Adivinaste la palabra.</p><p style="font-weight: bold; color: var(--primary);">Bonificaci√≥n: +$10</p>`;
            initConfetti();
            playApplause();
        } else {
            state.lives--;
            document.getElementById('lives-count').textContent = state.lives;
            content.innerHTML = `<h2 style="color: #b91c1c; margin:0">GAME OVER</h2><p>La palabra era: <br><strong style="font-size: 1.2rem; color: #1e3a8a;">${state.word}</strong></p>`;
        }
        overlay.style.display = 'flex';
        state.word = ""; 
    }

    function nextStep() {
        document.getElementById('overlay').style.display = 'none';
        if (state.lives <= 0) {
            alert("Has agotado tus vidas. Reiniciando...");
            location.reload();
        } else {
            document.getElementById('screen-game').classList.remove('active');
            document.getElementById('screen-start').classList.add('active');
            updateMotivation();
        }
    }

    window.addEventListener('resize', () => {
        confettiCanvas.width = window.innerWidth;
        confettiCanvas.height = window.innerHeight;
    });

    init();
</script>

</body>
</html>