<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Gallows - Checo</title>
    
    <!-- PWA Meta Tags -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#1e3a8a">
    <link rel="apple-touch-icon" href="icon-192.png">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <style>
        :root {
            --primary: #1e3a8a;
            --secondary: #991b1b;
            --accent: #f59e0b;
            --text: #1f2937;
            --card-bg: rgba(255, 255, 255, 0.95);
        }

        * {
            box-sizing: border-box;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: #0f172a;
            background-image: radial-gradient(at 0% 0%, hsla(253,16%,7%,1) 0, transparent 50%), 
                              radial-gradient(at 50% 0%, hsla(225,39%,30%,1) 0, transparent 50%);
            background-attachment: fixed;
            margin: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: var(--text);
            padding: 15px;
        }

        #install-banner {
            display: none;
            position: fixed;
            top: 20px;
            background: var(--accent);
            color: #78350f;
            padding: 12px 25px;
            border-radius: 50px;
            font-weight: 800;
            z-index: 1000;
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
            cursor: pointer;
            border: 2px solid white;
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn { from { transform: translateY(-100px); } to { transform: translateY(0); } }

        .container {
            background: var(--card-bg);
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            max-width: 450px;
            padding: 1.5rem; 
            border-radius: 28px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            text-align: center;
            position: relative;
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            width: 100%;
            margin-bottom: 15px;
            font-size: 0.7rem;
            color: #94a3b8;
            font-weight: bold;
            letter-spacing: 1px;
        }

        h1 {
            font-size: 2.2rem;
            margin: 0 0 15px 0;
            color: var(--primary);
            letter-spacing: 3px;
            font-weight: 900;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            width: 100%;
            margin-bottom: 20px;
        }

        .stat-card {
            background: #f1f5f9;
            padding: 10px;
            border-radius: 15px;
            font-weight: 800;
            color: var(--primary);
        }

        .screen { display: none; width: 100%; flex-direction: column; align-items: center; }
        .active { display: flex; }

        .cat-btn {
            width: 100%;
            padding: 15px;
            margin: 5px 0;
            border: none;
            border-radius: 15px;
            background: white;
            color: var(--primary);
            font-weight: 800;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            cursor: pointer;
            border: 1px solid #e2e8f0;
            transition: all 0.2s;
        }
        .cat-btn:active { transform: scale(0.98); background: #f8fafc; }

        #hangman-canvas {
            background: white;
            border-radius: 20px;
            margin-bottom: 15px;
            border: 1px solid #e2e8f0;
        }

        .word-box {
            font-size: 1.8rem;
            letter-spacing: 6px;
            margin: 15px 0;
            font-family: monospace;
            font-weight: 900;
            color: var(--primary);
        }

        .keyboard {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            width: 100%;
        }

        .key {
            padding: 10px 0;
            border: 1px solid #e2e8f0;
            background: white;
            border-radius: 8px;
            font-weight: bold;
            font-size: 0.8rem;
            cursor: pointer;
        }
        .key.correct { background: #10b981; color: white; }
        .key.wrong { background: #ef4444; color: white; }
        .key:disabled { opacity: 0.5; cursor: default; }

        .footer-watermark {
            margin-top: 20px;
            font-size: 0.55rem;
            color: #cbd5e1;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.85);
            display: none; justify-content: center; align-items: center; z-index: 2000;
            backdrop-filter: blur(4px);
        }
        .modal { background: white; padding: 30px; border-radius: 24px; width: 85%; max-width: 320px; text-align: center; }
    </style>
</head>
<body>

<div id="install-banner">INSTALAR GALLOWS üì≤</div>

<div class="container">
    <div class="header-top">
        <span>Gallows</span>
        <span style="opacity: 0.3;">CHECHO</span>
    </div>

    <h1>GALLOWS</h1>

    <div class="stats-grid">
        <div class="stat-card">Vidas: <span id="lives">5</span> ‚ù§Ô∏è</div>
        <div class="stat-card">Premio: <span id="reward">$0</span> üí∞</div>
    </div>

    <div id="screen-start" class="screen active">
        <p style="font-weight: bold; color: #64748b;">Elige Categor√≠a:</p>
        <div id="cat-list" style="width: 100%;"></div>
    </div>

    <div id="screen-game" class="screen">
        <canvas id="hangman-canvas" width="180" height="180"></canvas>
        <div id="word-display" class="word-box"></div>
        <div id="kb" class="keyboard"></div>
        <button class="cat-btn" style="margin-top:20px; background: var(--primary); color: white;" onclick="solve()">RESOLVER</button>
    </div>

    <div class="footer-watermark">Developed by Tecnotic ¬© 2026</div>
</div>

<div id="overlay" class="overlay">
    <div class="modal" id="modal-box"></div>
</div>

<script>
    // --- PWA LOGIC ---
    let deferredPrompt;
    window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        deferredPrompt = e;
        document.getElementById('install-banner').style.display = 'block';
    });

    async function installApp() {
        if (!deferredPrompt) return;
        document.getElementById('install-banner').style.display = 'none';
        deferredPrompt.prompt();
        deferredPrompt = null;
    }
    document.getElementById('install-banner').onclick = installApp;

    // Registro del Service Worker con protecci√≥n para entornos de desarrollo/blob
    if ('serviceWorker' in navigator && window.location.protocol.startsWith('http')) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('./sw.js')
                .then(reg => console.log('Service Worker registrado correctamente'))
                .catch(err => console.warn('No se pudo registrar el SW (normal en entornos de preview):', err));
        });
    }

    // --- GAME LOGIC ---
    const data = {
        "Frutas": ["MANZANA", "PERA", "PLATANO", "SANDIA", "MANGO"],
        "Cine": ["AVATAR", "TITANIC", "SHREK", "BATMAN", "ALIEN"],
        "Autos": ["TESLA", "FERRARI", "MAZDA", "TOYOTA", "FORD"]
    };

    let state = { lives: 5, reward: 0, word: "", guesses: [], mistakes: 0 };
    const cvs = document.getElementById('hangman-canvas');
    const ctx = cvs.getContext('2d');

    function init() {
        const list = document.getElementById('cat-list');
        Object.keys(data).forEach(c => {
            const b = document.createElement('button');
            b.className = 'cat-btn';
            b.innerText = c;
            b.onclick = () => start(c);
            list.appendChild(b);
        });
    }

    function start(c) {
        state.word = data[c][Math.floor(Math.random()*data[c].length)];
        state.guesses = [];
        state.mistakes = 0;
        document.getElementById('screen-start').classList.remove('active');
        document.getElementById('screen-game').classList.add('active');
        drawBase();
        renderKb();
        update();
    }

    function drawBase() {
        ctx.clearRect(0,0,180,180);
        ctx.strokeStyle = "#334155"; ctx.lineWidth = 4;
        ctx.beginPath();
        ctx.moveTo(20, 160); ctx.lineTo(160, 160);
        ctx.moveTo(40, 160); ctx.lineTo(40, 20);
        ctx.lineTo(120, 20); ctx.lineTo(120, 40);
        ctx.stroke();
    }

    function drawPart(m) {
        ctx.strokeStyle = "#1e3a8a";
        switch(m) {
            case 1: ctx.beginPath(); ctx.arc(120, 55, 15, 0, Math.PI*2); ctx.stroke(); break;
            case 2: ctx.beginPath(); ctx.moveTo(120, 70); ctx.lineTo(120, 120); ctx.stroke(); break;
            case 3: ctx.beginPath(); ctx.moveTo(120, 80); ctx.lineTo(100, 100); ctx.stroke(); break;
            case 4: ctx.beginPath(); ctx.moveTo(120, 80); ctx.lineTo(140, 100); ctx.stroke(); break;
            case 5: ctx.beginPath(); ctx.moveTo(120, 120); ctx.lineTo(100, 150); ctx.stroke(); break;
        }
    }

    function renderKb() {
        const box = document.getElementById('kb');
        box.innerHTML = "";
        "ABCDEFGHIJKLMN√ëOPQRSTUVWXYZ".split("").forEach(l => {
            const b = document.createElement('button');
            b.className = 'key'; b.innerText = l;
            b.onclick = () => guess(l, b);
            box.appendChild(b);
        });
    }

    function guess(l, btn) {
        if (btn.disabled) return;
        btn.disabled = true;
        if (state.word.includes(l)) {
            state.guesses.push(l);
            btn.classList.add('correct');
        } else {
            state.mistakes++;
            btn.classList.add('wrong');
            drawPart(state.mistakes);
            if (state.mistakes >= 5) end(false);
        }
        update();
    }

    function update() {
        const d = state.word.split("").map(l => state.guesses.includes(l) ? l : "_").join("");
        document.getElementById('word-display').innerText = d;
        if (!d.includes("_") && state.word !== "") end(true);
    }

    function solve() {
        const val = prompt("¬øCu√°l es la palabra?");
        if (val && val.toUpperCase() === state.word) {
            state.guesses = state.word.split("");
            update();
        } else if (val) { 
            alert("Incorrecto"); 
            state.mistakes++; 
            drawPart(state.mistakes); 
            if(state.mistakes >= 5) end(false); 
        }
    }

    function end(win) {
        const over = document.getElementById('overlay');
        const box = document.getElementById('modal-box');
        over.style.display = 'flex';
        if (win) {
            state.reward += 10;
            box.innerHTML = `<h2>¬°GANASTE!</h2><p>+ $10</p><button class="cat-btn" onclick="reset()">OTRA</button>`;
        } else {
            state.lives--;
            box.innerHTML = `<h2 style="color:red">PERDISTE</h2><p>Era: ${state.word}</p><button class="cat-btn" onclick="reset()">REINTENTAR</button>`;
        }
        document.getElementById('lives').innerText = state.lives;
        document.getElementById('reward').innerText = `$${state.reward}`;
    }

    function reset() {
        document.getElementById('overlay').style.display = 'none';
        if (state.lives <= 0) {
            alert("Vidas agotadas. Reiniciando juego.");
            location.reload();
        } else {
            document.getElementById('screen-game').classList.remove('active');
            document.getElementById('screen-start').classList.add('active');
        }
    }

    init();
</script>
</body>
</html>